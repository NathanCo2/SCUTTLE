<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SCUTTLE: src/Core/Src/task5.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Krabby Logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">SCUTTLE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a2f0e5642e47e7ed59fe0f0829eafb5f.html">Core</a></li><li class="navelem"><a class="el" href="dir_98d33a86cef786dafad53fd2007ffe4c.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">task5.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of Task 5: Arm Motor Control.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="task5_8h_source.html">task5.h</a>&quot;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &quot;<a class="el" href="_counter_8h_source.html">Counter.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad60fde44074584df97b70bcf261d09cc" id="r_ad60fde44074584df97b70bcf261d09cc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad60fde44074584df97b70bcf261d09cc">task5_run</a> (uint8_t *State, uint8_t *ArmON, uint8_t *<a class="el" href="main_8c.html#a6bc2ffdcd82ea08dbc034eacbde34801">Metal_Found</a>, <a class="el" href="struct_t_i_m___handle_type_def.html">TIM_HandleTypeDef</a> Timer, uint32_t *<a class="el" href="main_8c.html#a1ccc2e6addda333d9269ca68059aaaea">sumval</a>)</td></tr>
<tr class="memdesc:ad60fde44074584df97b70bcf261d09cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run task 5 FSM, controlling the arm motor based on metal detection and operational state.  <br /></td></tr>
<tr class="separator:ad60fde44074584df97b70bcf261d09cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a630f1eeed416e3137a95eedfade5e10f" id="r_a630f1eeed416e3137a95eedfade5e10f"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a630f1eeed416e3137a95eedfade5e10f">Arm_Encoder_CPR</a> = 979.2</td></tr>
<tr class="separator:a630f1eeed416e3137a95eedfade5e10f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23a31f31ed1135914a06e01beb812aa0" id="r_a23a31f31ed1135914a06e01beb812aa0"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a23a31f31ed1135914a06e01beb812aa0">SweepDeg</a> = 60</td></tr>
<tr class="separator:a23a31f31ed1135914a06e01beb812aa0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af63e486565bc815458b5a2563efe948b" id="r_af63e486565bc815458b5a2563efe948b"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af63e486565bc815458b5a2563efe948b">Arm_Pos_Target</a></td></tr>
<tr class="separator:af63e486565bc815458b5a2563efe948b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad454b832ef86d6116aecf6dd3c4c93d1" id="r_ad454b832ef86d6116aecf6dd3c4c93d1"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad454b832ef86d6116aecf6dd3c4c93d1">Arm_Deg_Target</a></td></tr>
<tr class="separator:ad454b832ef86d6116aecf6dd3c4c93d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09e5dec3752e4b23d3a9aaa3b8ced9a" id="r_ad09e5dec3752e4b23d3a9aaa3b8ced9a"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad09e5dec3752e4b23d3a9aaa3b8ced9a">Deg_inc</a></td></tr>
<tr class="separator:ad09e5dec3752e4b23d3a9aaa3b8ced9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d23f0d7aaa206c6af821ae87c63cb19" id="r_a9d23f0d7aaa206c6af821ae87c63cb19"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9d23f0d7aaa206c6af821ae87c63cb19">Time_Start</a></td></tr>
<tr class="separator:a9d23f0d7aaa206c6af821ae87c63cb19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bb3de0989064d1768112893f5448069" id="r_a4bb3de0989064d1768112893f5448069"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4bb3de0989064d1768112893f5448069">TimerStarted</a> = 0</td></tr>
<tr class="separator:a4bb3de0989064d1768112893f5448069"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5a448c312dee725559da2ad1fc1d9ee" id="r_ab5a448c312dee725559da2ad1fc1d9ee"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab5a448c312dee725559da2ad1fc1d9ee">S3_First</a> = 0</td></tr>
<tr class="separator:ab5a448c312dee725559da2ad1fc1d9ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a842fe98bec340e480860d0c46903f16d" id="r_a842fe98bec340e480860d0c46903f16d"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a842fe98bec340e480860d0c46903f16d">ArmDir</a> = 1</td></tr>
<tr class="separator:a842fe98bec340e480860d0c46903f16d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2b8a0691585930eaa0035ba2a85d421" id="r_af2b8a0691585930eaa0035ba2a85d421"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af2b8a0691585930eaa0035ba2a85d421">TimeDiff</a></td></tr>
<tr class="separator:af2b8a0691585930eaa0035ba2a85d421"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9b9190f033bda9823ce3857ce63a221" id="r_ab9b9190f033bda9823ce3857ce63a221"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab9b9190f033bda9823ce3857ce63a221">sumval_old</a> = 0</td></tr>
<tr class="separator:ab9b9190f033bda9823ce3857ce63a221"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a114db00dde726edfa5ab6e2cd9c700b0" id="r_a114db00dde726edfa5ab6e2cd9c700b0"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a114db00dde726edfa5ab6e2cd9c700b0">Metal_Delta</a></td></tr>
<tr class="separator:a114db00dde726edfa5ab6e2cd9c700b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a424ba95ef49d23966f514baed780717f" id="r_a424ba95ef49d23966f514baed780717f"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a424ba95ef49d23966f514baed780717f">K_arm</a> = 1</td></tr>
<tr class="separator:a424ba95ef49d23966f514baed780717f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of Task 5: Arm Motor Control. </p>
<p>Implementation of Task 6: Drive Motor Control.</p>
<p>NOTE: THIS FILE IS NOT YET FULLY IMPLEMENTED. SEE CAPITALIZED COMMENTS FOR CODE STILL NEEDED. This file contains the implementation of the state machine for controlling the Arm Motor. It includes functions to manage the Arm's movement based on metal detection and passive sweeping.</p>
<dl class="section date"><dt>Date</dt><dd>Jun 8, 2024 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>tawel</dd></dl>
<p>This file contains the implementation of the state machine for controlling the drive motors. This includes implementing data from the OpenMV camera to control steering rate and desired velocity. This uses closed loop PI control. The motors will stop automatically if metal is detected or if the camera cannot see the April Tag.</p>
<dl class="section date"><dt>Date</dt><dd>Jun 8, 2024 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>tawel </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="ad60fde44074584df97b70bcf261d09cc" name="ad60fde44074584df97b70bcf261d09cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad60fde44074584df97b70bcf261d09cc">&#9670;&#160;</a></span>task5_run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task5_run </td>
          <td>(</td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>State</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>ArmON</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *</td>          <td class="paramname"><span class="paramname"><em>Metal_Found</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_t_i_m___handle_type_def.html">TIM_HandleTypeDef</a></td>          <td class="paramname"><span class="paramname"><em>Timer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *</td>          <td class="paramname"><span class="paramname"><em>sumval</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run task 5 FSM, controlling the arm motor based on metal detection and operational state. </p>
<p>Run task 5, controlling the arm motor based on metal detection and operational state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">State</td><td>Pointer to the state variable. </td></tr>
    <tr><td class="paramname">ArmON</td><td>Pointer to the variable indicating whether the arm motor is enabled. </td></tr>
    <tr><td class="paramname">Metal_Found</td><td>Pointer to the variable indicating whether metal is detected. </td></tr>
    <tr><td class="paramname">Timer</td><td>Timer handle for timing operations. </td></tr>
    <tr><td class="paramname">sumval</td><td>Pointer to the variable storing the sum value from metal detection. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ad454b832ef86d6116aecf6dd3c4c93d1" name="ad454b832ef86d6116aecf6dd3c4c93d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad454b832ef86d6116aecf6dd3c4c93d1">&#9670;&#160;</a></span>Arm_Deg_Target</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float Arm_Deg_Target</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Target position of the Arm Motor in degrees </p>

</div>
</div>
<a id="a630f1eeed416e3137a95eedfade5e10f" name="a630f1eeed416e3137a95eedfade5e10f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a630f1eeed416e3137a95eedfade5e10f">&#9670;&#160;</a></span>Arm_Encoder_CPR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float Arm_Encoder_CPR = 979.2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Number of encoder ticks per revolution of the Arm Motor </p>

</div>
</div>
<a id="af63e486565bc815458b5a2563efe948b" name="af63e486565bc815458b5a2563efe948b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af63e486565bc815458b5a2563efe948b">&#9670;&#160;</a></span>Arm_Pos_Target</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float Arm_Pos_Target</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Target position of the Arm Motor in encoder ticks </p>

</div>
</div>
<a id="a842fe98bec340e480860d0c46903f16d" name="a842fe98bec340e480860d0c46903f16d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a842fe98bec340e480860d0c46903f16d">&#9670;&#160;</a></span>ArmDir</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t ArmDir = 1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Direction of Arm movement </p>

</div>
</div>
<a id="ad09e5dec3752e4b23d3a9aaa3b8ced9a" name="ad09e5dec3752e4b23d3a9aaa3b8ced9a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09e5dec3752e4b23d3a9aaa3b8ced9a">&#9670;&#160;</a></span>Deg_inc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float Deg_inc</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Increment of degrees for Arm movement </p>

</div>
</div>
<a id="a424ba95ef49d23966f514baed780717f" name="a424ba95ef49d23966f514baed780717f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a424ba95ef49d23966f514baed780717f">&#9670;&#160;</a></span>K_arm</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float K_arm = 1</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Arm control gain value </p>

</div>
</div>
<a id="a114db00dde726edfa5ab6e2cd9c700b0" name="a114db00dde726edfa5ab6e2cd9c700b0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a114db00dde726edfa5ab6e2cd9c700b0">&#9670;&#160;</a></span>Metal_Delta</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t Metal_Delta</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Difference between old and new metal detector reading </p>

</div>
</div>
<a id="ab5a448c312dee725559da2ad1fc1d9ee" name="ab5a448c312dee725559da2ad1fc1d9ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5a448c312dee725559da2ad1fc1d9ee">&#9670;&#160;</a></span>S3_First</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t S3_First = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flag to determine if it is the first time through state 3 </p>

</div>
</div>
<a id="ab9b9190f033bda9823ce3857ce63a221" name="ab9b9190f033bda9823ce3857ce63a221"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab9b9190f033bda9823ce3857ce63a221">&#9670;&#160;</a></span>sumval_old</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t sumval_old = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Old sumval measurement for metal detection </p>

</div>
</div>
<a id="a23a31f31ed1135914a06e01beb812aa0" name="a23a31f31ed1135914a06e01beb812aa0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23a31f31ed1135914a06e01beb812aa0">&#9670;&#160;</a></span>SweepDeg</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t SweepDeg = 60</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Number of degrees for sweep each side </p>

</div>
</div>
<a id="a9d23f0d7aaa206c6af821ae87c63cb19" name="a9d23f0d7aaa206c6af821ae87c63cb19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9d23f0d7aaa206c6af821ae87c63cb19">&#9670;&#160;</a></span>Time_Start</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t Time_Start</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Used to find deltaT for timing </p>

</div>
</div>
<a id="af2b8a0691585930eaa0035ba2a85d421" name="af2b8a0691585930eaa0035ba2a85d421"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2b8a0691585930eaa0035ba2a85d421">&#9670;&#160;</a></span>TimeDiff</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float TimeDiff</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Time difference variable </p>

</div>
</div>
<a id="a4bb3de0989064d1768112893f5448069" name="a4bb3de0989064d1768112893f5448069"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bb3de0989064d1768112893f5448069">&#9670;&#160;</a></span>TimerStarted</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t TimerStarted = 0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flag to determine if the timer has started </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
